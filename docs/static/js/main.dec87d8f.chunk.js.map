{"version":3,"sources":["../../src/index.js","../../src/App.jsx","../../src/runAppannie.js","../../src/utils/index.js","../../src/utils/injectCss.js","../../src/utils/injectJs.js"],"names":["jses","csses","Bluebird","map","item","injectJs","injectCss","node","document","createElement","ReactDOM","render","React","App","body","appendChild","runAppannie","then","res","console","log","catch","err","error","main","Timer","props","state","seconds","this","setState","interval","setInterval","tick","clearInterval","Component","style","position","zIndex","bottom","left","background","color","width","children","Container","Row","Col","md","src","block","getObjectValue","path","object","defaultValue","split","Array","isArray","length","key","slicedPath","slice","Object","hasOwnProperty","call","getShortMarketName","fullName","toast","text","type","window","siiimpleToast","fetch","setTimeout","location","reload","href","includes","status","RegExp","test","__NEXT_DATA__","is404Page","innerText","startsWith","pageVal","productId","productTitle","pathname","method","mode","fullMarketName","app_id","String","market_name","companyId","companyName","obj_nav","company","id","name","shortMarketName","productUniversalProductId","product","market","universal_product_id","universalPoductId","universalPoductName","universalPoductIcon","universal_product","icon","publisher","appName","appIcon","_market","storeUrl","exec","marketId","url","URL","urlParams","URLSearchParams","search","get","meta_data","headers","Accept","JSON","stringify","statusText","success","alert","getElementsByTagName","tag","setAttribute","Promise","resolve","reject","script","onload"],"mappings":"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","file":"static/js/main.dec87d8f.chunk.js","sourcesContent":["/* eslint-disable no-console */\n/* global document */\nimport ready from '@lskjs/utils/polyfill';\nimport Bluebird from 'bluebird';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport { App } from './App';\nimport { runAppannie } from './runAppannie';\nimport { injectCss, injectJs } from './utils';\n\nready();\n\nconst jses = ['https://cdn.jsdelivr.net/npm/siiimple-toast/dist/siiimple-toast.min.js'];\nconst csses = [\n  'https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css',\n  'https://cdn.jsdelivr.net/npm/siiimple-toast/dist/style.css',\n];\n\nconst main = async () => {\n  await Bluebird.map(jses, (item) => injectJs(item));\n  await Bluebird.map(csses, (item) => injectCss(item));\n\n  const node = document.createElement('div');\n  ReactDOM.render(React.createElement(App), node);\n  document.body.appendChild(node);\n\n  runAppannie()\n    .then((res) => {\n      console.log('[runAppannie] ok', res);\n    })\n    .catch((err) => {\n      console.error('[runAppannie] err', err);\n    });\n};\n\nmain();\n","import Button from '@lskjs/button';\nimport { Col, Container, Row } from '@lskjs/grid';\nimport React from 'react';\n\nclass Timer extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { seconds: 0 };\n  }\n\n  tick() {\n    this.setState((state) => ({\n      seconds: state.seconds + 1,\n    }));\n  }\n\n  componentDidMount() {\n    this.interval = setInterval(() => this.tick(), 1000);\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.interval);\n  }\n\n  render() {\n    return <div>Seconds: {this.state.seconds}</div>;\n  }\n}\n\nconst style = {\n  position: 'fixed',\n  zIndex: 99999,\n  bottom: 0,\n  left: 0,\n  background: 'gray',\n  color: 'white',\n  width: '100%',\n};\n\nexport const App = ({ children }) => (\n  <div style={style}>\n    <Container>\n      <Row>\n        <Col md={6}>\n          <h1>Buzzguru</h1>\n          <Timer />\n        </Col>\n        <Col md={3}>\n          <img src=\"https://buzzguru.github.io/userscript/logo.png\" />\n        </Col>\n        <Col md={3}>\n          <Button block>Hello!</Button>\n        </Col>\n      </Row>\n    </Container>\n  </div>\n);\n\nexport default App;\n","/* global document window fetch */\n\nexport function getObjectValue(path, object, defaultValue = null) {\n  if (typeof path === 'string') {\n    return getObjectValue(path.split(/\\./), object, defaultValue);\n  }\n\n  if (!Array.isArray(path) || path.length === 0) {\n    return defaultValue;\n  }\n\n  const [key] = path;\n  const slicedPath = path.slice(1);\n\n  if (!object || typeof object !== 'object' || !Object.hasOwnProperty.call(object, key)) {\n    return defaultValue;\n  }\n\n  if (slicedPath.length === 0) {\n    return object[key];\n  }\n  return getObjectValue(slicedPath, object[key], defaultValue);\n}\n\nexport function getShortMarketName(fullName) {\n  if (fullName === 'google-play') {\n    return 'gp';\n  }\n  return fullName;\n}\n\nexport function toast(text, { type = 'message' } = {}) {\n  console.log('[toast]', text);\n  if (!window.siiimpleToast) return;\n  window.siiimpleToast[type](text);\n  fetch('/i18n/activate/en/').then(() => {\n    setTimeout(() => {\n      window.location.reload();\n    }, 2000);\n  });\n}\n\n// @match        *://www.appannie.com/ru/apps/ios/app/*/details*\n// @match        *://www.appannie.com/ru/apps/google-play/app/*/details*\n// @match        *://www.appannie.com/ru/apps/*/app/*/details*\n// @match        *://www.appannie.com/apps/ios/app/*/details*\n// @match        *://www.appannie.com/apps/google-play/app/*/details*\n// @match        *://www.appannie.com/apps/*/app/*/details*\n\nexport async function runAppannie() {\n  const location = document?.location?.href || '';\n  if (!location.includes('://www.appannie.com')) return { status: 'ignoreDomain' };\n  const regexp = new RegExp('://www.appannie.com/.*apps/.+/app/.+/details');\n  if (!regexp.test(location)) return { status: 'ignore' };\n\n  // console.log('[runAppannie] @');\n  const { __NEXT_DATA__ } = window;\n  const is404Page = document.body.innerText.startsWith('Oops! 404');\n  if (!is404Page && getObjectValue('props.pageProps.locale.language', __NEXT_DATA__) !== 'en-US') {\n    await toast('Язык страницы не английский, переключаем на английский');\n    return { status: 'changeLocale' };\n  }\n  const pageVal = {\n    location: window.location.href,\n  };\n  const productId = getObjectValue('props.pageProps.app.id', __NEXT_DATA__);\n  const productTitle = getObjectValue('props.pageProps.app.name', __NEXT_DATA__);\n  if (is404Page || !productId || (productTitle && productTitle === 'Unknown Product')) {\n    await fetch(`https://worker.buzz.guru/api/appannie/notFound?location=${document.location.pathname}`, {\n      method: 'POST',\n      mode: 'no-cors',\n    });\n    toast('Спаршено 404', { type: 'alert' });\n    console.log('Отрепорти эту ссылку в чатик');\n    return { status: '404' };\n  }\n\n  const fullMarketName = getObjectValue('props.pageProps.market', __NEXT_DATA__);\n\n  if (productId) {\n    pageVal.app_id = String(productId);\n  }\n\n  if (fullMarketName) {\n    pageVal.market_name = fullMarketName;\n  }\n\n  const companyId = getObjectValue('props.pageProps.company.id', __NEXT_DATA__);\n  const companyName = getObjectValue('props.pageProps.company.name', __NEXT_DATA__);\n\n  if (companyId || companyName) {\n    if (!pageVal.obj_nav) {\n      pageVal.obj_nav = {};\n    }\n    if (!pageVal.obj_nav.company) {\n      pageVal.obj_nav.company = {};\n      if (companyId) {\n        pageVal.obj_nav.company.id = String(companyId);\n      }\n      if (companyName) {\n        pageVal.obj_nav.company.name = companyName;\n      }\n    }\n  }\n\n  const shortMarketName = getShortMarketName(fullMarketName);\n  const productUniversalProductId = getObjectValue('props.pageProps.unifiedApp.id', __NEXT_DATA__);\n\n  if (productId || shortMarketName || productUniversalProductId) {\n    if (!pageVal.obj_nav) {\n      pageVal.obj_nav = {};\n    }\n    if (!pageVal.obj_nav.product) {\n      pageVal.obj_nav.product = {};\n      if (productId) {\n        pageVal.obj_nav.product.id = String(productId);\n      }\n      if (shortMarketName) {\n        pageVal.obj_nav.product.market = shortMarketName;\n      }\n      if (productUniversalProductId) {\n        pageVal.obj_nav.product.universal_product_id = String(productUniversalProductId);\n      }\n    }\n  }\n\n  const universalPoductId = getObjectValue('props.pageProps.unifiedApp.id', __NEXT_DATA__);\n  const universalPoductName = getObjectValue('props.pageProps.unifiedApp.name', __NEXT_DATA__);\n  const universalPoductIcon = getObjectValue('props.pageProps.unifiedApp.icon', __NEXT_DATA__);\n\n  if (universalPoductId || universalPoductName || universalPoductIcon) {\n    if (!pageVal.obj_nav) {\n      pageVal.obj_nav = {};\n    }\n    if (!pageVal.obj_nav.universal_product) {\n      pageVal.obj_nav.universal_product = {};\n      if (universalPoductId) {\n        pageVal.obj_nav.universal_product.id = String(universalPoductId);\n      }\n      if (universalPoductName) {\n        pageVal.obj_nav.universal_product.name = universalPoductName;\n      }\n      if (universalPoductIcon) {\n        pageVal.obj_nav.universal_product.icon = universalPoductIcon;\n      }\n    }\n  }\n\n  const publisher = getObjectValue('props.pageProps.publisher', __NEXT_DATA__);\n  if (publisher) {\n    pageVal.publisher = publisher;\n  }\n\n  const appName = getObjectValue('props.pageProps.app.name', __NEXT_DATA__);\n  const appIcon = getObjectValue('props.pageProps.app.icon', __NEXT_DATA__);\n  const _market = getObjectValue('props.pageProps.app.market', __NEXT_DATA__);\n  const status = getObjectValue('props.pageProps.app.status', __NEXT_DATA__);\n  let market;\n  if (_market === 'google-play') market = 'gp';\n  if (_market === 'apple-store') market = 'ios';\n  const storeUrl = getObjectValue('props.pageProps.app.url', __NEXT_DATA__);\n  let marketId;\n  if (market === 'ios') {\n    const [, id] = /\\/id(\\d+)/.exec(storeUrl);\n    marketId = id;\n  }\n  if (market === 'gp') {\n    const url = new URL(storeUrl);\n    const urlParams = new URLSearchParams(url.search);\n    marketId = urlParams.get('id');\n  }\n  pageVal.meta_data = {};\n  if (appName) {\n    pageVal.meta_data.name = appName;\n  }\n  if (appIcon) {\n    pageVal.meta_data.icon = appIcon;\n  }\n  if (market) {\n    pageVal.meta_data.market = market;\n  }\n  if (marketId) {\n    pageVal.meta_data.marketId = marketId;\n  }\n  if (typeof status === 'number') {\n    pageVal.meta_data.status = status;\n  }\n  try {\n    const res =\n      (await fetch('https://worker.buzz.guru/api/appannie/updateOne', {\n        method: 'post',\n        headers: {\n          Accept: 'application/json',\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(pageVal),\n      })) || {};\n    console.log({ status: res.status, statusText: res.statusText });\n    window.siiimpleToast.success('Приложение спаршено');\n  } catch (e) {\n    window.siiimpleToast.alert('Произошла ошибка при запросе к воркеру');\n  }\n  return { status: 'ok' };\n}\n\nexport default runAppannie;\n","export * from './injectCss';\nexport * from './injectJs';\n","/* global document */\n\nexport function injectCss(href) {\n  const node = document.getElementsByTagName('head')[0];\n  const tag = document.createElement('link');\n  tag.setAttribute('rel', 'stylesheet');\n  tag.setAttribute('type', 'text/css');\n  tag.setAttribute('href', href);\n  node.appendChild(tag);\n}\n\nexport default injectCss;\n","/* global document */\n\nexport function injectJs(href) {\n  return new Promise((resolve, reject) => {\n    const script = document.createElement('script');\n    script.src = href;\n    script.onload = resolve;\n    script.error = reject;\n    document.body.appendChild(script);\n  });\n}\n\nexport default injectJs;\n"],"sourceRoot":""}